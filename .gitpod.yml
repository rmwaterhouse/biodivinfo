# gitpod configuration file for 2023 SIB course on Biodiversity bioinformatics

# Base docker image to create the workspace
# Runs on Ubuntu 22.04
image: gitpod/workspace-base

# List start up tasks
tasks:
  - name: computing terminal
    # Install mamba and create computing environment
    init: |
      curl -L -O "https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-$(uname)-$(uname -m).sh"
      bash Mambaforge-$(uname)-$(uname -m).sh -b -p /workspace/mambaforge
      rm Mambaforge-$(uname)-$(uname -m).sh
      /workspace/mambaforge/bin/mamba init bash
      source ${HOME}/.bashrc
      mamba env create -f envs/course.yaml
      mamba clean --all -y
      cd /workspace/biodivinfo/envs
      wget https://github.com/hahnlab/CAFE5/releases/download/v5.1/CAFE5-5.1.0.tar.gz
      tar -xf CAFE5-5.1.0.tar.gz
      rm CAFE5-5.1.0.tar.gz
      cd CAFE5
      ./configure
      make
      export PATH="/workspace/biodivinfo/envs/CAFE5/bin:$PATH"
    # Activate working environment, add cafe5 to PATH and clean terminal
    command: |
      /workspace/mambaforge/bin/mamba init bash
      source ~/.bashrc
      mamba activate course
      export PATH="/workspace/biodivinfo/envs/CAFE5/bin:$PATH"
      reset

